{% extends 'guesswhich/base.html' %} {% block sidebar %} {% endblock %} {% block images %}
<div class="row">
    <div class="col s12 m9 l9 imagesParentContainer" id="imagesParentContainer">
        {% for i in img_list %}
        <div class="col s12 sampleImagesContainer mix" id="{{ i.img_id }}" data-score="{{ i.score }}">
            <img src="{{ i.image_path }}" class="sampleImage", height=200, width=175>
            <b class="imageRank"></b>
            <i class="large material-icons center red-text thumb_down_icon" style="display: none;">close</i>
            <a class="waves-effect waves-light btn blue selectImage center" style="display: none;">Select</a>
            <i class="large material-icons center green-text thumb_down_icon" style="display: none;">check</i>
            <!-- <a class="waves-effect waves-light btn red ignoreImage center" style="display: none;">Ignore</a> -->
            <b id="{{ i.img_id }}_score" class="imageScore"></b>
        </div>
        {% endfor %}
    </div>
    <div class="col s12 m3 l3">
        <div class="col s12 m3 l3 card chatBoxContainer">
            <div class="card-content ChatBoxCardContentDiv">
                <div class="messages">
                    <div class="row chat_bot_row">
                        <div class="col s12 l10 left chat_bot">
                            <div class="card-panel black-text grey lighten-3">
                                <span class="black-text">{{ bot_intro_message }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="row chat_bot_row">
                        <img src="{{static_data_dir}}/images/abot.png" width="40px" height="40px" class="square" align="left">
                        <div class="col s12 l10 left chat_bot">
                            <div class="card-panel black-text grey lighten-3">
                                <span>Based on your understanding of the image description, pick the image that you think is the most relevant.</span>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="input-field messageInputField">
                    <input id="question" type="text" class="autocomplete" placeholder="Start typing question here ..." autocomplete="off">
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block message_typing %}



<!--IMPORTANT: This import contains all the functions you need to read in your input data and send back worker outputs.-->  
{% include "easyturk.html" %}

<script>
    // Define some default input.
    // It is good practice to define standard inputs for a task which will be overwritten when launching
    // your actual task. The default inputs allow you to render and debug your task locally.
    var DEFAULT_INPUT = [{"url": "https://cs.stanford.edu/people/rak248/VG_100K/1160052.jpg"},
                         {"url": "https://cs.stanford.edu/people/rak248/VG_100K/1160053.jpg"}]

   
    // Some variables to track state of the HIT.
    var idx = 0;
    var enabled = false;

    function main() {
      // If this is a HIT on AMT, then replace the default input with the real
      // input.
      input = easyturk.getInput(DEFAULT_INPUT);
      console.log("retrieved input: ")
      console.log(input)

      // Enable the task.
      if (!easyturk.isPreview()){
        console.log("task enabled")
        enableTask();
      }

      render();
    }

    // Use the current index to update the image and description
    function render() {

      // Refresh the counter
      $('.counter-top').text(idx + 1);
      $('.counter-bottom').text(input.length);

      // If the UI is enabled, enable or disable the buttons depending on
      // the index.
      if (enabled) {
        $('#prev-btn').prop('disabled', false);
        $('#next-btn').prop('disabled', false);
        if (idx == 0) {
          $('#prev-btn').prop('disabled', true);
        }
        if (idx == input.length - 1) {
          $('#next-btn').prop('disabled', true);
        }
      }
    }

    // Update the index, and save the text in the text area.
    function setIdx(newIdx) {
      if (newIdx < 0 || newIdx >= input.length) return;
      idx = newIdx;
      render();
    }

    function taskComplete() {
      if (final_output == null) {
        alert("You haven't finished the dialog yet. Complete all {{ num_of_games_in_a_hit }} turns to finish this task!")
        return false;
      } else {
        return true;
      }
    }

    // Enable the UI.
    function enableTask() {
        enabled = true;
        easyturk.setupSubmit();

        // Enable components
        $('#next-btn').click(function() {
            /*if (saveCaption()) {
                setIdx(idx + 1);
            }*/
            console.log("hit next")
            if (taskComplete()) {
              setIdx(idx+1)
            }
        });
        $('#prev-btn').click(function() {
            /*if (saveCaption()) {
                setIdx(idx - 1);
            }*/
            console.log("hit prev")
            if (taskComplete()) {
              setIdx(idx-1)
            }
        });
        $('#submit-btn').prop('disabled', false);


        $('#submit-btn').click(function() {
            //output = {"foo": "bar"}
            output = JSON.stringify(final_output)
            if (easyturk.isPreview()) {
                alert("This is only a preview. Here is your output: \n" + JSON.stringify(output));
                return false;
            } else {
                console.log("sending output")
                console.log(output)
                easyturk.setOutput(output);
                //alert(output)
                return true;
            }

      });
    }

    main();
</script>


<script>
    // Copied from static_data_dir/js/queryparam_helper.js
    // ===========================================================
    // A bunch of helper functions for an AMT interface 
    // ===========================================================

    // Note: QS is short for query string, i.e., the <name>=<value> stuff after the
    // question mark (?) in the URL.
    var NUM_QS_ZEROPAD = 2; // Number of digits for QS parameters

    function gup(name) {
        var regexS = "[\\?&]" + name + "=([^&#]*)";
        var regex = new RegExp(regexS);
        var tmpURL = window.location.href;
        var results = regex.exec(tmpURL);
        if (results == null) {
            return "";
        } else {
            return results[1];
        }
    }

    function decode(strToDecode) {
        return unescape(strToDecode.replace(/\+/g, " "));
    }

    function get_random_int(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    function zero_pad(num, numZeros) {
        var n = Math.abs(num);
        var zeros = Math.max(0, numZeros - Math.floor(n).toString().length );
        var zeroString = Math.pow(10,zeros).toString().substr(1);
        if (num < 0) {
            zeroString = '-' + zeroString;
        }
        return zeroString+n;
    }

    function collect_ordered_QS(param_name, pad) {
        var array = []; // Store all the data
        var done = false;
        var i = 1;
        var name = '';
        var val = '';
        while (done == false) {
            name = param_name + zero_pad(i, pad);
            val = decode(gup(name));

            if (val == "") {
                done = true;
            } else {
                array.push(val);
            }
            i += 1;
        }
        return array;
    }
</script>

<script type="text/javascript">
var show_feedback_modal = "{{ show_feedback_modal }}";
var total_bonus_so_far = {{ total_bonus_so_far }};
var current_bonus = {{ max_game_bonus }};
var bonus_deduction_on_each_click = {{ bonus_deduction_on_each_click }};
var bonus_for_correct_image_after_each_round = {{ bonus_for_correct_image_after_each_round }};
var current_in_game_bonus = 0;
var final_image_list = [];
var finalImageSelected = false;
var targetImage = "{{ target_image }}";
var targetImageId = "{{ target_image_id }}";
var topImage = $(".sampleImagesContainer").first().attr("id");
var question_index = 0;
var current_question = "";
var current_answer = "";
var current_user_selected_image = null;
var current_user_sorting = {{ img_id_list | safe }};
var current_fc7_sorting = null;
var prev_history = "{{ caption }}";
var scores = {{ scores | safe}};
var current_round = 0;
var num_of_games_in_a_hit = {{ num_of_games_in_a_hit }};
var max_rounds = {{ max_rounds }};
var next_game_url = null;
var target_image_rank_list = [];
var message_just_shown = false;
var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";

//var socket = new ReconnectingWebSocket(ws_scheme + '://' + window.location.host + "/chat" + window.location.pathname);
var study_type = "{{ study_type }}"
var answerer_type = "{{ translator_type }}"
var translator_type = "{{ answerer_type }}"
var pool_index = "{{ pool_index }}"
var dialog_history = []
var difficulty_level = "{{ difficulty_level }}"
var image_selections = []
var final_output = null

function respond(question) {
    //TODO, get response
    response = "Bot response to: '"+question+"'!"
    show_bot_message(response)
    dialog_history.push(['bot_response', response])

    $(".selectImage").removeClass("disabled");
}
/*
socket.onmessage = function(response) {
    response = JSON.parse(response.data);
    if ("result" in response) {
        result = JSON.parse(response['result']);
        show_bot_message(result['answer']);
        current_answer = result['answer'];
        prev_history = result['history'];
        $(".selectImage").removeClass("disabled");
    }
}
*/


function getWordCount(jobID) {
  var timeout = "";

  var poller = function() {
    // fire another request
    $http.get('/results/'+jobID).
      success(function(data, status, headers, config) {
        if(status === 202) {
          $log.log(data, status);
        } else if (status === 200){
          $log.log(data);
          $timeout.cancel(timeout);
          return false;
        }
        // continue to call the poller() function every 2 seconds
        // until the timeout is cancelled
        timeout = $timeout(poller, 2000);
      });
  };
  poller();
}

function ShowServerResponse(response) {
    console.log("parsing: response = ", response)
    var translator_prediction = response[0]
    var answer = response[1]

    if (study_type == "no_translator") {
        show_bot_message(answer)
        dialog_history.push(['bot_answer', answer])
    } else if (study_type == "translator_show_answer") {
        if (translator_prediction == 1) {
          show_bot_message(answer)
          dialog_history.push(['bot_answer', answer])
        } else if (translator_prediction == 0) {
            translator_failure_message = "Sorry, I don't understand this question. Try asking me about something else!"
            show_bot_message(translator_failure_message)
            dialog_history.push(['translator', translator_failure_message])

            answerer_message = "I would have said: "+answer
            show_bot_message(answerer_message)
            dialog_history.push(['bot_answer', answerer_message])
        }
    } else if (study_type == "translator_ask_show_answer") {
        if (translator_prediction == 1) {
          show_bot_message(answer)
          dialog_history.push(['bot_answer', answer])
        } else if (translator_prediction == 0) {
            translator_failure_message = "Sorry, I don't understand this question. Do you want to see my answer anyway?"
            show_bot_message(translator_failure_message)
            dialog_history.push(['translator', translator_failure_message])

            view_answer = true //TODO
            if (view_answer) {
                answerer_message = "My answer is \""+answer+"\"."
                show_bot_message(answerer_message)
                dialog_history.push(['bot_answer', answerer_message])
            }
            
        }
    } else {
        console.log("Invalid study type")
        show_bot_message("This HIT isn't configured right. Exit and send us an email and we'll fix it.")
    }
    
    console.log("done updating server response")
    $(".selectImage").removeClass("disabled");
}

function getAnswer(jobID) {
    var timeout_id = "";
    var response = null;

  var poller = function() {
    // fire another request
    console.log("firing get request:")
    console.log(jobID)
    $.get('https://bluelagoon.stanford.edu:5000/get_guess_which_results/'+jobID).
      success(function(data, status, headers, config) {
        //console.log("success function executing, status:")
        //console.log("status:",status)
        //console.log("headers:", headers)
        //console.log("data:", data)
        if(headers.status === 202) { // "Nay!"
            console.log("status =  202")
            console.log(data, status);
        } else if (headers.status === 200){
          console.log("successful retrieval, status =  200:")
          console.log(data); //data is a list: [0, '<answer>']; 0 or 1 indicates translator response, string is the answer
          //clearTimeout(timeout_id);
          response = data;
          console.log("parsing server response")
          ShowServerResponse(response);
          return false;
        } else {
            console.log("neither")
        }
        // continue to call the poller() function every 2 seconds
        // until the timeout is cancelled
        console.log("setting timeout")
        timeout_id = setTimeout(poller, 2000);
      });
  };
  console.log("calling poller:")
  poller();
  console.log("exiting poller.")
  //console.log("end of function call, retrieved data:")
  //console.log(final_data)
}

function getAnswerNG(jobID) {
  var timeout = "";

  var poller = function() {
    // fire another request
    console.log("firing get request:")
    console.log(jobID)
    $.get('https://bluelagoon.stanford.edu:5000/get_guess_which_results/'+jobID).
      success(function(data, status, headers, config) {
        if(status === 202) {
          console.log(data, status);
        } else if (status === 200){
          console.log(data); //data is a list: [0, '<answer>']; 0 or 1 indicates translator response, string is the answer
          $timeout.cancel(timeout);
          return data;
        }
        // continue to call the poller() function every 2 seconds
        // until the timeout is cancelled
        timeout = $timeout(poller, 2000);
      });
  };
  var data = poller();
  console.log("get data:")
  console.log(data)
}

function post_debugging() {
    /*
        $.post('http://bluelagoon.stanford.edu:5000/guess_which', post_request).
            success(function(results) {
                console.log("results:")
                console.log(results);
                var data = getAnswer(results);
                var translator_prediction = data[0]
                var answer = data[1]

                if (translator_prediction == 1) {
                    show_bot_message(answer)
                    dialog_history.push(['bot_answer', answer])

                } else if (translator_prediction == 0) {
                    translator_failure_message = "Sorry, I don't understand this question. Try asking me about something else!"
                    show_bot_message(translator_failure_message)
                    dialog_history.push(['translator', translator_failure_message])
                }

          }).
            error(function(error) {
                console.log("error:")
                console.log(error);
                show_bot_message("Sorry, there was an error in retrieving the answer to your question. Please try again!")
                dialog_history.push(['bot_response', '<error>'])

          });
          */
        
        

        /*
        var success_function = function(results) {
            console.log("results:")
            console.log(results);
            var data = getAnswer(results);
            var translator_prediction = data[0]
            var answer = data[1]

            if (translator_prediction == 1) {
                show_bot_message(answer)
                dialog_history.push(['bot_answer', answer])

            } else if (translator_prediction == 0) {
                translator_failure_message = "Sorry, I don't understand this question. Try asking me about something else!"
                show_bot_message(translator_failure_message)
                dialog_history.push(['translator', translator_failure_message])
            }
        }

        var error_function = function(error) {
            console.log("error:")
            console.log(error);
            show_bot_message("Sorry, there was an error in retrieving the answer to your question. Please try again!")
            dialog_history.push(['bot_response', '<error>'])         
        }
        

        $.post({
                'url': 'http://bluelagoon.stanford.edu:5000/guess_which', 
                'data':post_request,
                //'success': success_function,
                //'error': error_function
                });
        */
          
        

        //console.log("updated")
        //console.log(JSON.stringify(post_request))
        //console.log(jQuery.isPlainObject(post_request))


          /*
        $.ajax({
            url:'http://bluelagoon.stanford.edu:5000/get_guess_which_results/f51bda2a-c721-46e8-a4be-e5160b2e6961',
            type: 'GET',
            data_type: "json",
            success: function(results) {
                console.log("results:")
                console.log(results);
                getAnswer(results);
            },
            error: function(error) {
                console.log("error:")
                console.log(error)
            }
        })*/
}

</script>
<script type="text/javascript">
$("body").keypress(function(e) {
    var key = e.which;
    var question = $("#question").val();
    if (key == 13 && question != '' && question != null) {
        console.log("send request:");
        console.log(JSON.stringify({
            event: "imageSubmitted",
            socketid: "{{ socketid }}",
            user_picked_image: current_user_selected_image,
            final_image_list: final_image_list,
            worker_id: worker_id,
            assignment_id: assignment_id,
            level: level,
            hit_id: hit_id,
            game_id: Number(gameId) + 1,
            round_id: current_round,
            question: current_question,
            answer: current_answer,
            history: prev_history,
            target_image: targetImageId,
            bot: bot,
            task: task,
        }));

        current_question = question;
        message_just_shown = false;
        $("#question").val('');
        $("#question").attr("disabled", "disabled");
        $(".selectImage").addClass("disabled");
        changeQuestionPlaceholder("Click on the image that is your best guess");

        if (current_round == max_rounds) {
            $("#question").attr("disabled", "disabled");
        }
        // Create div of the user's message
        var userChatDiv = $('<div class="row chat_row_human"></div>');
        var userColDiv = $('<div class="col s9 l7 right"></div>');
        var userCardPanelDiv = $('<div class="card-panel light-blue darken-4 right"></div>');

        $(userCardPanelDiv).prepend('<span class="white-text"><b>Q:' + (current_round + 1) + "/" + max_rounds + " </b>" + question + '</span>');
        $(userColDiv).prepend(userCardPanelDiv);
        $(userChatDiv).prepend(userColDiv);
        $(".messages").append(userChatDiv);

        // Now scroll to the bottom of the messages
        var wtf = $('.messages');
        var height = wtf[0].scrollHeight;
        wtf.scrollTop(height);

        if (current_user_selected_image == targetImageId) {
            current_in_game_bonus += bonus_for_correct_image_after_each_round;
        }

        // update history to send to server at the end:
        dialog_history.push(["user_question", question])
        image_selections.push(current_user_selected_image)

        // $("#total_bonus_so_far").text(current_in_game_bonus);

        current_user_selected_image = null;        
        current_round += 1

        console.log("send second request: ")
        console.log(JSON.stringify({
            event: "questionSubmitted",
            socketid: "{{ socketid }}",
            images: {{img_id_list | safe}},
            scores: scores,
            question: question,
            target_image: targetImage,
            prev_history: prev_history,
            bot: bot,
            task: task,
        }));

        //send to server: target image id + jpg, translator/answerer type (category or all_categories), question
        post_request = {"img_path": targetImageId+'.jpg',
                        "question": question,
                        "answerer_path": answerer_type,
                        "translator_path": translator_type};

        console.log("posting:");
        console.log(post_request);
        

        
        $.ajax({
            url:"https://bluelagoon.stanford.edu:5000/guess_which",
            type: "POST",
            data: JSON.stringify(post_request),
            dataType: "text",
            contentType: "application/json",
            headers: {

            },
            success: function(results) {
                console.log("success:");
                console.log(results);
                getAnswer(results);
            },
            error: function(error) {
                console.log("error:");
                console.log(error);
                show_bot_message("Sorry, there was an error in retrieving the answer to your question. Please try again!")
                dialog_history.push(['bot_response', '<error>'])
            }
        });

        //respond(question)
        console.log("done processing keypress.")

    }
});
</script>

<script type="text/javascript">
$('.button-collapse').sideNav({
    menuWidth: 400, // Default is 240
    edge: 'right', // Choose the horizontal origin
});
</script>

<script type="text/javascript">
function show_bot_message(message) {
    var botChatDiv = $('<div class="row chat_bot_row"></div>');
    var botImage = $('<img src="{{static_data_dir}}/images/abot.png" width="40px" height="40px" class="square" align="left">');
    var botColDiv = $('<div class="col s12 l10 left chat_bot"></div>');
    var botCardPanelDiv = $('<div class="card-panel black-text grey lighten-3"></div>');

    $(botCardPanelDiv).prepend('<span class="black-text">' + message + '</span>');
    $(botColDiv).prepend(botCardPanelDiv);
    $(botChatDiv).prepend(botColDiv);
    $(botChatDiv).prepend(botImage);
    $(".messages").append(botChatDiv);
    $.playSound("{{ static_data_dir }}/slack_sound.mp3");
    var wtf = $('.messages');
    var height = wtf[0].scrollHeight;
    wtf.scrollTop(height);
}

function changeQuestionPlaceholder(placeholder) {
    $("#question").attr("placeholder", placeholder);
}
</script>
{% include 'guesswhich/modal.html' %}
{% include 'guesswhich/mturk.html' %}
<script type="text/javascript">
    function proceedToNextGame() {
        console.log(gameId);
         // update server on this game: translator_type, answerer_type, dialog_history, pool_index
        //                             image guesses, final_image_list
        post_request = {"event": "game_completed",
                        "pool_index": pool_index,
                        "translator_type": translator_type,
                        "answerer_type": answerer_type,
                        "dialog_history": dialog_history,
                        "image_selections": image_selections,
                        "final_image_list": final_image_list,
                        "current_game_bonus": current_bonus,
                        "total_bonus_so_far": total_bonus_so_far}
        console.log("Posting end-game update:")
        console.log(post_request)
        final_output = post_request
        
        if (gameId != num_of_games_in_a_hit) {
            // console.log("THIS IS FUCKING WORKING");
            // $("#hitEndModal").modal('open');
            // WONT GO HERE

            location.reload();
        } else {
            console.log("Finished!")
            output = final_output
            if (easyturk.isPreview()) {
                alert("This is only a preview. Here is your output: \n" + JSON.stringify(output));
            return false;
            } else {
                console.log("sending output")
                console.log(output)
                easyturk.setOutput(output);
                $("#submit-btn").click();
                return true;
            }
            //console.log("modal")
            //$("#hitEndModal").modal("open");
        }
    }
    $("#hitEndButton").click(function () {
        console.log("Hit end button.")
        // THIS ISNT CALLED ANYWHERE
        //submit_form();
             //$("#mturk_form").submit();
    });

    $(".selectImage").click(function(){
        console.log("in .selectImage")
        if (!$(this).hasClass("disabled")) {
            console.log("changing placeholder to type question")
            changeQuestionPlaceholder("Start typing question here ...");
            $(".selectImage").parent().removeClass("highlight-image");

            if (!finalImageSelected) {
                $(this).parent().addClass("highlight-image");
                current_user_selected_image = $(this).parent().attr('id');
                // console.log("CURRENT SELECTED IMAGE IS " + current_user_selected_image);
                $("#question").removeAttr("disabled");
                $("#question").focus();
                console.log("question no longer disabled, applied focus")

                if (!message_just_shown && current_round != max_rounds) {
                    message = "You can update your guess now. You will get a bonus if you correctly guess the target image. Bonus won will be shown at the end of the game. Once you’re ready, ask me a question! You can only ask me questions (avoid using “Thanks”, “Okay” for example), and please keep your questions relevant to image content, or your work will be rejected."
                    show_bot_message(message);                    
                }
                message_just_shown = true;

                if (current_round == max_rounds) {
                    changeQuestionPlaceholder("Click on the image that is your best guess");
                    console.log("selected image, max round. Sending:")
                    console.log(JSON.stringify({
                        event: "imageSubmitted",
                        socketid: "{{ socketid }}",
                        user_picked_image: current_user_selected_image,
                        final_image_list: final_image_list,
                        worker_id: worker_id,
                        assignment_id: assignment_id,
                        level: level,
                        hit_id: hit_id,
                        game_id: Number(gameId) + 1,
                        round_id: current_round,
                        question: current_question,
                        answer: current_answer,
                        history: prev_history,
                        target_image: targetImageId,
                        bot: bot,
                        task: task,
                    }));

                    if (current_user_selected_image == targetImageId) {
                        current_in_game_bonus += bonus_for_correct_image_after_each_round;
                    }
                    image_selections.push(current_user_selected_image)


                    // $("#total_bonus_so_far").text(current_in_game_bonus);

                    $("#question").attr("disabled", "disabled");
                    message = "Finally, select your best guess image. If that is not correct, try again."
                    show_bot_message(message);
                    message = "<b>Remember that your bonus depends on how many incorrect guesses you make before you find the target image!</b>"
                    show_bot_message(message);
                    finalImageSelected = true;

                }
            }
            else { // condition where the user is done with all the rounds.

                final_image_list.push($(this).parent().attr('id'));

                if ($(this).parent().attr('id') == targetImageId) {
                    current_bonus = current_bonus + current_in_game_bonus;
                    total_bonus_so_far = total_bonus_so_far + current_bonus;
                    $("#total_bonus_so_far").text(total_bonus_so_far);
                    $("#bonus_for_this_game").text(0.0);
                    $(this).next().show();
                    console.log("done with the rounds, sending final selections:")
                    console.log(JSON.stringify({
                        event: "finalImagesSelected",
                        socketid: "{{ socketid }}",
                        final_image_list: final_image_list,
                        worker_id: worker_id,
                        assignment_id: assignment_id,
                        level: level,
                        hit_id: hit_id,
                        game_id: Number(gameId) + 1,
                        target_image: targetImageId,
                        bot: bot,
                        task: task,
                        bonus: current_bonus,
                    }));

                    gameId = Number(gameId) + 1;       
                    next_game_url = updateQueryStringParameter(window.location.href, 'gameId', gameId);
                    // $("#plotModal").modal('open');
                    changeQuestionPlaceholder("Click above button to proceed.");
                    $(".selectImage").attr('style','display:none !important');
                    message = "Thanks for playing the game.<br> The target image is <img src='{{ target_image }}' height='300px' width='300px'>";
                    show_bot_message(message);

                    var number_of_correct_guesses_during_dialog = current_in_game_bonus/bonus_for_correct_image_after_each_round;
                    message = "You earned "+ current_in_game_bonus +" additional points for guessing the target image correctly " + number_of_correct_guesses_during_dialog + " out of " + (max_rounds+1) + " times during the game. Total points earned is " + current_bonus;
                    show_bot_message(message);

                    if (gameId == num_of_games_in_a_hit) {
                        message = '<a id="submit-btn-dialog" onClick="proceedToNextGame()" class="btn btn-large blue waves-effect waves-light center">Submit</a>';
                    } else {
                        message = '<a id="submit-btn-dialog" onClick="proceedToNextGame()" class="btn btn-large blue waves-effect waves-light center">Proceed to next game</a>';
                    }
                    show_bot_message(message);

                } else {
                    $(this).addClass("disabled");
                    $(this).attr('style','display:none !important');
                    $(this).prev().show();
                    current_bonus = current_bonus - bonus_deduction_on_each_click;
                    $("#bonus_for_this_game").text(current_bonus);
                    // $(this).parent().css("opacity", 0.2);
                }
            }
        }
    });
    console.log("disabling question and changing placeholder to image")
    $("#question").attr("disabled", "disabled");
    changeQuestionPlaceholder("Click on the image that is your best guess");
    $(document).ready(function(){
        if (gameId == 0) {
            // $("#instructionsModal").modal("open");
        }
        // $("#hitEndModal").modal("open");
    });
</script>

<script type="text/javascript">
$('#hitEndModal').modal({
    dismissible: false, // Modal can be dismissed by clicking outside of the modal
    opacity: 0.6, // Opacity of modal background
    ready: function() {}, // Callback for Modal open
    complete: function() {}
});
$('#instructionsModal').modal({
    dismissible: true, // Modal can be dismissed by clicking outside of the modal
    opacity: 0.6, // Opacity of modal background
    ready: function() {}, // Callback for Modal open
    complete: function() {}
});

</script>
<script type="text/javascript">
$(document).ready(function(){
    if (show_feedback_modal == "True") {
        // console.log("MODAL SHOULD OPEN HERE");
        //$("#hitEndModal").modal("open");
    }
});
</script>
{% endblock %}
